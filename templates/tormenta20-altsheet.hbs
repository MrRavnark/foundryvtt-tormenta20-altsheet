<form class="t20as-sheet {{cssClass}} {{actor.system.activeThemeClass}}" autocomplete="off">
    {{!-- Sheet Header --}}
    <header class="sheet-header">
        <div class="header-section header-top">
            <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
            <div class="header-details">
                <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Nome do Personagem"/></h1>
                <div class="summary-details">
                    <input type="text" name="system.details.raca.value" value="{{detalhes.raca}}" placeholder="Raça"/>
                    <input type="text" name="system.details.origem.value" value="{{detalhes.origem}}" placeholder="Origem"/>
                    <input type="text" name="system.details.classe.value" value="{{detalhes.classe}}" placeholder="Classe"/>
                </div>
            </div>
        </div>

        <div class="header-section header-attributes">
            {{!-- PV, PM, Defesa (ainda como inputs, mas estilizados) --}}
            <div class="attribute-box pv-pm">
                <label>PV</label>
                <input type="number" name="system.attributes.pv.value" value="{{atributos.pv.value}}" placeholder="0"/>
                <span>/</span>
                <input type="number" name="system.attributes.pv.max" value="{{atributos.pv.max}}" placeholder="0"/>
            </div>
             <div class="attribute-box pv-pm">
                <label>PM</label>
                <input type="number" name="system.attributes.pm.value" value="{{atributos.pm.value}}" placeholder="0"/>
                <span>/</span>
                <input type="number" name="system.attributes.pm.max" value="{{atributos.pm.max}}" placeholder="0"/>
            </div>
            <div class="attribute-box defense">
                <label>Defesa</label>
                <input type="number" name="system.attributes.defesa.value" value="{{atributos.defesa.value}}" placeholder="0"/>
            </div>

            {{!-- Atributos FOR, DES, CON, INT, SAB, CAR --}}
            {{#each T20.atributos as |attrDef key|}} 
            <div class="attribute-box simple-attribute">
                <label>{{localize attrDef}}</label> 
                <input type="number" name="system.attributes.{{key}}.value" value="{{atributos.[key].value}}" placeholder="0"/>
                <span class="attribute-mod">{{atributos.[key].mod}}</span> 
            </div>
            {{/each}}
        </div>
    </header>

    {{!-- Sheet Body - Layout Principal de 3 Colunas --}}
    <section class="sheet-body three-column-layout">
        {{!-- Coluna 1: Imagem (já no header), Equipamentos, Favoritos --}}
        <aside class="sheet-sidebar left-sidebar">
            <h3>Equipamento / Ataques</h3>
            <p>Lista de ataques e equipamentos aqui.</p>
            <h3>Ações Favoritas</h3>
            <p>Ações marcadas como favoritas aparecerão aqui.</p>
        </aside>

        {{!-- Coluna 2: PV/PM (barras), Defesas (Fortitude, Reflexo, Vontade), Recursos, Abas de Navegação, Conteúdo das Abas --}}
        <div class="main-content-column">
            <div class="resource-display">
                {{!-- PV e PM como barras de vida/mana --}}
                <div class="hp-mp-bar pv-bar">
                    <label>PV</label>
                    <span class="current">{{atributos.pv.value}}</span> / <span class="max">{{atributos.pv.max}}</span>
                    <div class="bar-fill" style="width: {{#if atributos.pv.max}}{{multiply (div atributos.pv.value atributos.pv.max) 100}}{{else}}0{{/if}}%;"></div>
                </div>
                <div class="hp-mp-bar mp-bar">
                    <label>PM</label>
                    <span class="current">{{atributos.pm.value}}</span> / <span class="max">{{atributos.pm.max}}</span>
                    <div class="bar-fill" style="width: {{#if atributos.pm.max}}{{multiply (div atributos.pm.value atributos.pm.max) 100}}{{else}}0{{/if}}%;"></div>
                </div>

                {{!-- Recursos (placeholder, será elaborado depois) --}}
                <h3>Recursos</h3>
                <p>Espaço para recursos como ki, arcanum, etc.</p>
            </div>

            {{!-- Defesas (Fortitude, Reflexos, Vontade) - Hexágonos --}}
            <div class="defenses-section">
                {{#each T20.resistencias as |resistenciaDef id|}}
                <div class="defense-hexagon {{id}}"> {{!-- Adiciona classe com o ID para estilo específico --}}
                    <label>{{localize resistenciaDef}}</label>
                    <span class="value">{{caracteristicas.resistencias.[id].value}}</span>
                </div>
                {{/each}}
            </div>

            {{!-- Abas de Navegação --}}
            <nav class="sheet-tabs tabs" data-group="primary">
                <a class="item active" data-tab="detalhes">{{ localize "T20AS.CharacterSheetLabelDark" }}</a>
                <a class="item" data-tab="inventario">{{ localize "PF1.Inventory" }}</a> 
                <a class="item" data-tab="poderes">Poderes</a>
                <a class="item" data-tab="caracteristicas">Características</a>
                <a class="item" data-tab="proficiencias">Proficiências</a>
                <a class="item" data-tab="condicoes">Condições</a>
            </nav>

            {{!-- Conteúdo das Abas --}}
            <div class="tab-content">
                <div class="tab" data-group="primary" data-tab="detalhes">
                    <h2>Detalhes do Personagem</h2>
                    <p>O ID da ficha é: <strong>{{this.options.id}}</strong></p>
                    <p>Classe do Tema Ativo: <strong>{{actor.system.activeThemeClass}}</strong></p>

                    <h3>Perícias:</h3>
                    <ul class="skills-list">
                        {{#each T20.pericias as |periciaDef id|}} 
                        <li class="skill-item">
                            <label>{{localize periciaDef.label}}:</label>
                            <input type="number" name="system.skills.{{id}}.value" value="{{pericias.[id].value}}" placeholder="0"/>
                            (Mod: <span class="skill-mod">{{pericias.[id].mod}}</span> | Bônus: <span class="skill-bonus">{{pericias.[id].bonus}}</span>)
                        </li>
                        {{/each}}
                    </ul>
                </div>

                <div class="tab" data-group="primary" data-tab="inventario">
                    <h2>Inventário</h2>
                    <p>Esta é a aba de inventário.</p>
                    <p>Aqui você listará seus equipamentos, armas e itens.</p>
                </div>

                <div class="tab" data-group="primary" data-tab="poderes">
                    <h2>Poderes e Habilidades</h2>
                    <p>Esta é a aba de poderes.</p>
                    <p>Aqui você listará seus talentos, magias e habilidades de classe/raça.</p>
                </div>

                <div class="tab" data-group="primary" data-tab="caracteristicas">
                    <h2>Outras Características</h2>
                    <p>Tamanho: <input type="text" name="system.details.tamanho.value" value="{{caracteristicas.tamanho}}" placeholder="Médio"/></p>
                    <p>Deslocamento: <input type="text" name="system.attributes.deslocamento.value" value="{{caracteristicas.deslocamento}}" placeholder="9m"/></p>

                    <h3>Resistências:</h3>
                    <ul class="resistance-list">
                        {{#each caracteristicas.resistencias as |resistencia id|}}
                        <li><label>{{localize resistencia.label}}:</label> {{resistencia.value}}</li>
                        {{/each}}
                    </ul>
                    <h3>Imunidades:</h3>
                    <ul class="immunity-list">
                        {{#each caracteristicas.imunidades as |imunidade id|}}
                        <li><label>{{localize imunidade.label}}:</label> {{imunidade.value}}</li>
                        {{/each}}
                    </ul>
                    <h3>Sentidos:</h3>
                    <ul class="senses-list">
                        {{#each caracteristicas.sentidos as |sentido id|}}
                        <li><label>{{localize sentido.label}}</label></li>
                        {{/each}}
                    </ul>
                </div>

                <div class="tab" data-group="primary" data-tab="proficiencias">
                    <h2>Proficiências</h2>
                    <h3>Armas:</h3>
                    <ul class="prof-weapons-list">
                        {{#each proficiencias.armas as |arma id|}}
                        {{#if proficiencias.armas.[id].value}} 
                        <li><label>{{localize arma.label}}</label></li>
                        {{/if}}
                        {{/each}}
                    </ul>
                    <h3>Armaduras:</h3>
                    <ul class="prof-armor-list">
                        {{#each proficiencias.armaduras as |armadura id|}}
                        {{#if proficiencias.armaduras.[id].value}} 
                        <li><label>{{localize armadura.label}}</label></li>
                        {{/if}}
                        {{/each}}
                    </ul>
                </div>

                <div class="tab" data-group="primary" data-tab="condicoes">
                    <h2>Condições</h2>
                    <ul class="conditions-list">
                        {{#each condicoes as |condicao id|}}
                        <li class="condition-item">
                            <img src="{{condicao.icon}}" title="{{condicao.name}}" width="24" height="24"/>
                            <label>{{condicao.name}}</label>
                        </li>
                        {{/each}}
                    </ul>
                </div>
            </div>
        </div>

        {{!-- Coluna 3: Atributos FOR, DES, CON, INT, SAB, CAR (já no header, apenas estilizaremos aqui) --}}
        <aside class="sheet-sidebar right-sidebar">
            <h3>Atributos</h3>
            {{!-- Os atributos já estão no header, mas podemos duplicá-los aqui se o layout exigir --}}
            {{!-- Ou podemos fazer um partial aqui que puxa os mesmos dados --}}
            <p>Os atributos principais (FOR, DES, etc.) serão estilizados como hexágonos aqui.</p>
            {{#each T20.atributos as |attrDef key|}} 
            {{#unless (or (eq key "pv") (eq key "pm") (eq key "defesa"))}} 
            <div class="attribute-hexagon {{key}}">
                <label>{{localize attrDef}}</label> 
                <span class="value">{{atributos.[key].value}}</span>
                <span class="mod">{{atributos.[key].mod}}</span>
            </div>
            {{/unless}}
            {{/each}}
        </aside>
    </section>
</form>